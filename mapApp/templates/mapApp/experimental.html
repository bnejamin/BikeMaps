{% extends "mapApp/base.html" %}
{% load staticfiles %}
{% load geojson_tags %}

{% block title %}
Experimental charting
{% endblock %}


{% block headerCSS %}
  <!-- Load leaflet -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
  <!-- font-awesome icons -->
  <link rel="stylesheet" href="{% static 'leaflet/plugins/awesome-markers/dist/leaflet.awesome-markers.css' %}">
  <!-- Local styles -->
  <style media="screen">
  svg {
    width: 100%;
    height: 100%;
  }
  path.slice{
    stroke-width:2px;
  }
  polyline{
    opacity: .3;
    stroke: black;
    stroke-width: 2px;
    fill: none;
  }
  </style>
{% endblock %}


{% block headerJS %}
<!-- d3 v3.4.8 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
<!-- moment.js date library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
<!-- Load leaflet -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<!-- Awesome markers -->
<script type="text/javascript" src="{% static 'leaflet/plugins/awesome-markers/dist/leaflet.awesome-markers.min.js' %}" charset="UTF-8"></script>
<!-- Icon definitions -->
<script src="{% static 'mapApp/js/icons.js' %}" charset="utf-8"></script>
<!-- moment -->
<script src="{% static 'moment/moment.min.js' %}"></script>

<!-- Viz functions -->
<!-- Doughnut chart -->
<script src="{% static 'mapApp/js/viz/doughnut.js' %}" charset="utf-8"></script>
{% endblock %}


{% block body %}
  <!-- D3 parallel coords chart -->
  <script charset="utf-8">
    var data = [
      {
          "name": "Collisions",
          "count": {{ collisions|length }},
          "color": getColor("collision"),
      },{
          "name": "Near misses",
          "count": {{ nearmisses|length }},
          "color": getColor("nearmiss"),
      },{
          "name": "Hazards",
          "count": {{ hazards|length }},
          "color": getColor("hazard"),
      },{
          "name": "Thefts",
          "count": {{ thefts|length }},
          "color": getColor("theft"),
      },
    ]
    // doughnutChart(data, "body");

    // Create month-wise dataset of counts for each collision type
    data = {}

    {% for p in points %}
      var p_type = ('{{ p.p_type|safe }}' == 'fall' ? 'collision':'{{ p.p_type|safe }}'),
        date = moment("{{ p.date|safe }}").format("MM-YYYY");

      if(!data[p_type])
        data[p_type] = {};

      data[p_type][date] = data[p_type][date] + 1 || 1;
    {% endfor %}
    console.log(data);

    




  </script>
{% endblock %}
