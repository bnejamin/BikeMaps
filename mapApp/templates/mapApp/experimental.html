{% extends "mapApp/base.html" %}
{% load staticfiles %}
{% load geojson_tags %}

{% block title %}
Experimental charting
{% endblock %}


{% block headerCSS %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
  <link rel="stylesheet" href="{% static 'leaflet/plugins/awesome-markers/dist/leaflet.awesome-markers.css' %}">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/dc/1.7.0/dc.css" media="screen">

  <style media="screen">
    svg {
      width: 100%;
      height: 100%;
    }
    path.slice{
      stroke-width:2px;
    }
    polyline{
      opacity: .3;
      stroke: black;
      stroke-width: 2px;
      fill: none;
    }
  </style>
{% endblock %}

{% block headerJS %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.11/crossfilter.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/dc/1.7.0/dc.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script type="text/javascript" src="{% static 'leaflet/plugins/awesome-markers/dist/leaflet.awesome-markers.min.js' %}" charset="UTF-8"></script>
<script src="{% static 'mapApp/js/icons.js' %}" charset="utf-8"></script>

<!-- Viz functions -->
<!-- Doughnut chart -->
<script src="{% static 'mapApp/js/viz/doughnut.js' %}" charset="utf-8"></script>
{% endblock %}


{% block body %}
  <!-- D3 parallel coords chart -->
  <script charset="utf-8">
    var data = [
      {
          "name": "Collisions",
          "count": {{ collisions|length }},
          "color": getColor("collision"),
      },{
          "name": "Near misses",
          "count": {{ nearmisses|length }},
          "color": getColor("nearmiss"),
      },{
          "name": "Hazards",
          "count": {{ hazards|length }},
          "color": getColor("hazard"),
      },{
          "name": "Thefts",
          "count": {{ thefts|length }},
          "color": getColor("theft"),
      },
    ]
    doughnutChart(data);

    data = {
      "collision": {{ collisions|geojsonfeature:"date,report_date"|safe }},
      "nearmiss": {{ nearmisses|geojsonfeature:"date,report_date"|safe }},
      "hazard": {{ hazards|geojsonfeature:"date,report_date"|safe }},
      "theft": {{ thefts|geojsonfeature:"date,report_date"|safe }}
    };

    console.log(data);

  </script>
{% endblock %}
